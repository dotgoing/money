(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[443],{2535:(e,t,s)=>{Promise.resolve().then(s.bind(s,4993))},4993:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l});var a=s(5155),r=s(2115),n=s(5565);function l(){let e="https://www.dotgoing.com/money/api",t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,{headers:{"Content-Type":"application/json",...t}})},s=(e,t)=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:t}),[l,o]=(0,r.useState)(""),[c,d]=(0,r.useState)(""),[i,x]=(0,r.useState)(""),[u,h]=(0,r.useState)(""),[m,p]=(0,r.useState)(""),[b,g]=(0,r.useState)(!1),[y,w]=(0,r.useState)(null),[j,N]=(0,r.useState)(!1),[f,v]=(0,r.useState)(!1),[k,_]=(0,r.useState)(30);(0,r.useEffect)(()=>{(async()=>{let s=await t("".concat(e,"/wx/login-qrcode")),a=await s.json();h(a.qrcode_url),x(a.session_id)})()},[]),(0,r.useEffect)(()=>{if(!i||b)return;let s=Date.now(),a=setInterval(()=>{_(Math.max(0,Math.ceil((s+3e4-Date.now())/1e3)))},1e3),r=setInterval(async()=>{try{let a=await t("".concat(e,"/wx/webhook?session_id=").concat(i)),n=await a.json();n.status?(g(!0),p(n.user_name),o(n.webhook_new||""),d(n.webhook_update||"")):Date.now()-s>3e4&&(clearInterval(r),v(!0))}catch(e){console.error("Login status check failed:",e),Date.now()-s>3e4&&(clearInterval(r),v(!0))}},2e3);return()=>{clearInterval(r),clearInterval(a)}},[i,b]);let S=async()=>{try{(await s("".concat(e,"/wx/webhook?session_id=").concat(i),JSON.stringify({new_url:l,update_url:c,user_name:m,type:"feishu",name:"飞书",description:"飞书 Webhook"}))).ok?N(!0):w({text:"保存失败，请重试",type:"error"})}catch(e){console.error("Save failed:",e),w({text:"保存失败，请重试",type:"error"})}},C=async(t,a)=>{try{let r=await s("".concat(e,"/wx/verify-feishu"),JSON.stringify({url:t,type:a})),n=await r.json();w({text:n.message||"测试成功",type:"success"}),setTimeout(()=>w(null),5e3)}catch(e){console.error("Test webhook failed:",e),w({text:"测试失败，请检查 URL 是否正确",type:"error"}),setTimeout(()=>w(null),5e3)}};return(0,a.jsxs)("div",{className:"min-h-screen p-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold mb-4 text-center",children:"飞书 Webhook"}),y&&(0,a.jsx)("div",{className:"mb-4 p-4 rounded-md ".concat("success"===y.type?"bg-green-100 text-green-700 border border-green-400":"bg-red-100 text-red-700 border border-red-400"),children:y.text}),b?(0,a.jsxs)("div",{className:"space-y-6 max-w-2xl mx-auto",children:[j?(0,a.jsx)("div",{className:"text-center text-xl font-medium text-green-600",children:"保存成功，开始在公众号输入收支信息吧！"}):(0,a.jsx)("div",{className:"webhook-settings",children:(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"用户名"}),(0,a.jsx)("input",{type:"text",value:m,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border rounded-md text-foreground bg-background",placeholder:"请输入用户名"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"飞书机器人 Webhook（插入）"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"url",value:l,onChange:e=>o(e.target.value),className:"flex-1 px-3 py-2 border rounded-md text-foreground bg-background",placeholder:"请输入用于插入数据的 Webhook 地址"}),(0,a.jsx)("button",{onClick:()=>C(l,"new"),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"测试"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"在飞书多维表格中配置机器人，获取用于插入数据的 Webhook 地址"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium",children:"飞书机器人 Webhook（更新）"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("input",{type:"url",value:c,onChange:e=>d(e.target.value),className:"flex-1 px-3 py-2 border rounded-md text-foreground bg-background",placeholder:"请输入用于更新数据的 Webhook 地址"}),(0,a.jsx)("button",{onClick:()=>C(c,"update"),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"测试"})]}),(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"在飞书多维表格中配置机器人，获取用于更新数据的 Webhook 地址"})]})]})}),!j&&(0,a.jsx)("button",{onClick:S,className:"px-4 py-2 bg-blue-500 text-white rounded-md",children:"保存设置"})]}):(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl mb-4",children:"微信扫码后设置"}),f?(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("p",{className:"text-red-500",children:"二维码已过期"}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"点击获取二维码"})]}):(0,a.jsx)(a.Fragment,{children:u&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.default,{src:u,alt:"Login QR Code",width:200,height:200,className:"mx-auto"}),(0,a.jsxs)("p",{className:"mt-2 text-gray-500",children:["二维码有效时间：",k," 秒"]})]})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[565,441,517,358],()=>t(2535)),_N_E=e.O()}]);