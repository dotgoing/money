(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[443],{2535:(e,t,a)=>{Promise.resolve().then(a.bind(a,7364))},7364:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>c});var s=a(5155),r=a(2115),l=a(4146),n=a.n(l);function c(){let e="https://www.dotgoing.com/money/api",t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,{headers:{"Content-Type":"application/json",...t}})},a=(e,t)=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:t}),[l,c]=(0,r.useState)(""),[d,o]=(0,r.useState)(""),[i,u]=(0,r.useState)(""),[x,m]=(0,r.useState)(""),[h,p]=(0,r.useState)(""),[g,f]=(0,r.useState)(""),[b,j]=(0,r.useState)(!1),[v,N]=(0,r.useState)(null),[y,w]=(0,r.useState)(!1),[_,S]=(0,r.useState)(!1),[k,C]=(0,r.useState)(30);(0,r.useEffect)(()=>{(async()=>{let a=await t("".concat(e,"/wx/login-qrcode")),s=await a.json();p(s.qrcode_url),m(s.session_id)})()},[]),(0,r.useEffect)(()=>{if(!x||b)return;let a=Date.now(),s=setInterval(()=>{C(Math.max(0,Math.ceil((a+3e4-Date.now())/1e3)))},1e3),r=setInterval(async()=>{try{let s=await t("".concat(e,"/wx/feishu?session_id=").concat(x)),l=await s.json();l.status?(j(!0),f(l.user_name||""),c(l.app_id||""),o(l.app_secret||""),u(l.table_url||"")):Date.now()-a>3e4&&(clearInterval(r),S(!0))}catch(e){console.error("Login status check failed:",e),Date.now()-a>3e4&&(clearInterval(r),S(!0))}},2e3);return()=>{clearInterval(r),clearInterval(s)}},[x,b]);let I=async()=>{try{(await a("".concat(e,"/wx/feishu?session_id=").concat(x),JSON.stringify({app_id:l,app_secret:d,user_name:g,table_url:i,type:"feishu",name:"飞书",description:"飞书 Webhook"}))).ok?w(!0):N({text:"保存失败，请重试",type:"error"})}catch(e){console.error("Save failed:",e),N({text:"保存失败，请重试",type:"error"})}};return(0,s.jsxs)("div",{className:"min-h-screen p-8",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold mb-4 text-center",children:"飞书表格配置"}),v&&(0,s.jsx)("div",{className:"mb-4 p-4 rounded-md ".concat("success"===v.type?"bg-green-100 text-green-700 border border-green-400":"bg-red-100 text-red-700 border border-red-400"),children:v.text}),b?(0,s.jsxs)("div",{className:"space-y-6 max-w-2xl mx-auto",children:[y?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-center text-xl font-medium text-green-600",children:"保存成功，开始在公众号输入收支信息吧！可扫码\uD83D\uDC47快速进入"}),(0,s.jsx)(n(),{src:"/images/qrcode.jpg",alt:"WeChat QR Code",width:200,height:200,className:"mx-auto"}),(0,s.jsx)("div",{className:"text-center text-xl font-medium text-green-600",children:"将公众号添加到桌面的步骤:"}),(0,s.jsx)(n(),{src:"/images/show-me.jpg",alt:"WeChat QR Code",width:777,height:350,className:"mx-auto"})]}):(0,s.jsx)("div",{className:"webhook-settings",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"用户名"}),(0,s.jsx)("input",{type:"text",value:g,onChange:e=>f(e.target.value),className:"w-full px-3 py-2 border rounded-md text-foreground bg-background",placeholder:"请输入用户名"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"飞书应用"}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsx)("input",{type:"url",value:l,onChange:e=>c(e.target.value),className:"flex-1 px-3 py-2 border rounded-md text-foreground bg-background",placeholder:"飞书应用 appId"})}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsx)("input",{type:"url",value:d,onChange:e=>o(e.target.value),className:"flex-1 px-3 py-2 border rounded-md text-foreground bg-background",placeholder:"飞书应用 appSecret"})})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"飞书多维表格"}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsx)("input",{type:"url",value:i,onChange:e=>u(e.target.value),className:"flex-1 px-3 py-2 border rounded-md text-foreground bg-background",placeholder:"飞书表格链接"})})]})]})}),!y&&(0,s.jsx)("button",{onClick:I,className:"px-4 py-2 bg-blue-500 text-white rounded-md",children:"保存设置"})]}):(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-xl mb-4",children:"微信扫码后设置"}),_?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-red-500",children:"二维码已过期"}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"点击获取二维码"})]}):(0,s.jsx)(s.Fragment,{children:h&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n(),{src:h,alt:"Login QR Code",width:200,height:200,className:"mx-auto"}),(0,s.jsxs)("p",{className:"mt-2 text-gray-500",children:["二维码有效时间：",k," 秒"]})]})})]})]})}},4146:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{default:function(){return d},getImageProps:function(){return c}});let s=a(306),r=a(666),l=a(7970),n=s._(a(5514));function c(e){let{props:t}=(0,r.getImgProps)(e,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,a]of Object.entries(t))void 0===a&&delete t[e];return{props:t}}let d=l.Image}},e=>{var t=t=>e(e.s=t);e.O(0,[970,441,517,358],()=>t(2535)),_N_E=e.O()}]);