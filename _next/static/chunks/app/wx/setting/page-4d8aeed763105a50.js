(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[443],{2535:(e,t,a)=>{Promise.resolve().then(a.bind(a,7364))},7364:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(5155),r=a(2115),n=a(4146),l=a.n(n);function o(){let e="https://www.dotgoing.com/money/api",t=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,{headers:{"Content-Type":"application/json",...t}})},a=(e,t)=>fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:t}),[n,o]=(0,r.useState)(""),[c,d]=(0,r.useState)(""),[i,u]=(0,r.useState)(""),[x,h]=(0,r.useState)(""),[m,g]=(0,r.useState)(""),[p,b]=(0,r.useState)(!1),[f,y]=(0,r.useState)(null),[j,w]=(0,r.useState)(!1),[v,N]=(0,r.useState)(!1),[k,_]=(0,r.useState)(30);(0,r.useEffect)(()=>{(async()=>{let a=await t("".concat(e,"/wx/login-qrcode")),s=await a.json();h(s.qrcode_url),u(s.session_id)})()},[]),(0,r.useEffect)(()=>{if(!i||p)return;let a=Date.now(),s=setInterval(()=>{_(Math.max(0,Math.ceil((a+3e4-Date.now())/1e3)))},1e3),r=setInterval(async()=>{try{let s=await t("".concat(e,"/wx/webhook?session_id=").concat(i)),n=await s.json();n.status?(b(!0),g(n.user_name),o(n.webhook_new||""),d(n.webhook_update||"")):Date.now()-a>3e4&&(clearInterval(r),N(!0))}catch(e){console.error("Login status check failed:",e),Date.now()-a>3e4&&(clearInterval(r),N(!0))}},2e3);return()=>{clearInterval(r),clearInterval(s)}},[i,p]);let C=async()=>{try{(await a("".concat(e,"/wx/webhook?session_id=").concat(i),JSON.stringify({new_url:n,update_url:c,user_name:m,type:"feishu",name:"飞书",description:"飞书 Webhook"}))).ok?w(!0):y({text:"保存失败，请重试",type:"error"})}catch(e){console.error("Save failed:",e),y({text:"保存失败，请重试",type:"error"})}},S=async(t,s)=>{try{let r=await a("".concat(e,"/wx/verify-feishu"),JSON.stringify({url:t,type:s})),n=await r.json();y({text:n.message||"测试成功",type:"success"}),setTimeout(()=>y(null),5e3)}catch(e){console.error("Test webhook failed:",e),y({text:"测试失败，请检查 URL 是否正确",type:"error"}),setTimeout(()=>y(null),5e3)}};return(0,s.jsxs)("div",{className:"min-h-screen p-8",children:[(0,s.jsx)("h1",{className:"text-4xl font-bold mb-4 text-center",children:"飞书 Webhook"}),f&&(0,s.jsx)("div",{className:"mb-4 p-4 rounded-md ".concat("success"===f.type?"bg-green-100 text-green-700 border border-green-400":"bg-red-100 text-red-700 border border-red-400"),children:f.text}),p?(0,s.jsxs)("div",{className:"space-y-6 max-w-2xl mx-auto",children:[j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"text-center text-xl font-medium text-green-600",children:"保存成功，开始在公众号输入收支信息吧！可扫码\uD83D\uDC47快速进入"}),(0,s.jsx)(l(),{src:"/images/qrcode.jpg",alt:"WeChat QR Code",width:200,height:200,className:"mx-auto"}),(0,s.jsx)("div",{className:"text-center text-xl font-medium text-green-600",children:"将公众号添加到桌面的步骤:"}),(0,s.jsx)(l(),{src:"/images/show-me.jpg",alt:"WeChat QR Code",width:777,height:350,className:"mx-auto"})]}):(0,s.jsx)("div",{className:"webhook-settings",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"用户名"}),(0,s.jsx)("input",{type:"text",value:m,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border rounded-md text-foreground bg-background",placeholder:"请输入用户名"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"飞书机器人 Webhook（插入）"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"url",value:n,onChange:e=>o(e.target.value),className:"flex-1 px-3 py-2 border rounded-md text-foreground bg-background",placeholder:"请输入用于插入数据的 Webhook 地址"}),(0,s.jsx)("button",{onClick:()=>S(n,"new"),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"测试"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"在飞书多维表格中配置机器人，获取用于插入数据的 Webhook 地址"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"飞书机器人 Webhook（更新）"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)("input",{type:"url",value:c,onChange:e=>d(e.target.value),className:"flex-1 px-3 py-2 border rounded-md text-foreground bg-background",placeholder:"请输入用于更新数据的 Webhook 地址"}),(0,s.jsx)("button",{onClick:()=>S(c,"update"),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600",children:"测试"})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"在飞书多维表格中配置机器人，获取用于更新数据的 Webhook 地址"})]})]})}),!j&&(0,s.jsx)("button",{onClick:C,className:"px-4 py-2 bg-blue-500 text-white rounded-md",children:"保存设置"})]}):(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h2",{className:"text-xl mb-4",children:"微信扫码后设置"}),v?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("p",{className:"text-red-500",children:"二维码已过期"}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:"点击获取二维码"})]}):(0,s.jsx)(s.Fragment,{children:x&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(l(),{src:x,alt:"Login QR Code",width:200,height:200,className:"mx-auto"}),(0,s.jsxs)("p",{className:"mt-2 text-gray-500",children:["二维码有效时间：",k," 秒"]})]})})]})]})}},4146:(e,t,a)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var a in t)Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}(t,{default:function(){return c},getImageProps:function(){return o}});let s=a(306),r=a(666),n=a(7970),l=s._(a(5514));function o(e){let{props:t}=(0,r.getImgProps)(e,{defaultLoader:l.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,a]of Object.entries(t))void 0===a&&delete t[e];return{props:t}}let c=n.Image}},e=>{var t=t=>e(e.s=t);e.O(0,[970,441,517,358],()=>t(2535)),_N_E=e.O()}]);